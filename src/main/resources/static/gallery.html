<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>경로 갤러리</title>
  <script
      src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6ee40960f56c83c4e7d4c2e6e3dacd0f&libraries=drawing"></script>
</head>
<body>
<h1>경로 갤러리</h1>
<button onclick="location.href='/index.html'">경로 저장 페이지로 이동</button>
<ul id="routeList"></ul>
<div id="map" style="width:100%; height:400px; display:none;"></div>

<script>
  // 경로 목록을 로드하는 함수
  function loadRoutes() {
      fetch('/api/routes/all')
          .then(response => response.json())
          .then(routes => {
              const routeList = document.getElementById('routeList');
              routeList.innerHTML = '';
              routes.forEach(route => {
                  const li = document.createElement('li');
                  // route.pathData를 JSON 문자열로 안전하게 전달
                  const safePathData = encodeURIComponent(route.pathData);
                  li.innerHTML = `<button onclick="showRoute('${safePathData}')">경로 ${route.id} 보기</button>`;
                  routeList.appendChild(li);
              });
          })
          .catch(error => console.error("갤러리 로드 오류:", error));
  }

  // 선택된 경로 데이터를 지도에 표시하는 함수
  function showRoute(encodedPathData) {
      try {
          document.getElementById('map').style.display = 'block';

          // 경로 데이터를 JSON으로 파싱
          const pathData = JSON.parse(decodeURIComponent(encodedPathData));
          console.log("경로 데이터:", pathData);

          const points = pathData[0].points.map(coord => new kakao.maps.LatLng(coord.y, coord.x));

          // 지도 초기화 및 설정
          const container = document.getElementById('map');
          const options = {
              center: points[0],
              level: 3
          };
          const map = new kakao.maps.Map(container, options);

          // Polyline 생성 및 지도에 표시
          const polyline = new kakao.maps.Polyline({
              path: points,
              map: map
          });
      } catch (error) {
          console.error("경로 표시 오류:", error);
          alert("경로 데이터를 표시할 수 없습니다.");
      }
  }

  // 페이지 로드 시 경로 목록을 불러옵니다
  loadRoutes();
</script>
</body>
</html>
